---
title: Stidner -- Discount Callback documentation

toc_footers:
  - <a href='http://stidner.com/'>About Stidner</a>
  - <a href='http://stidner.com/'>Request an API key</a>

search: true
---

# Discount Callback

This document references the discount system and how it all connects.
There are two parts in this process:

1. [Stidner Checkout's request](#stidner-checkouts-request), and
2. [Merchant's response](#merchants-response)


As a reminder, this is a callback for the Order API; please [read it](index.html) first if you have not already!

## Stidner Checkout's request

> Example request:

```http
POST /discounts HTTP/1.1
Host: merchant.example.com
Authorization: Basic
Content-Type: application/json
```
```json
{
    "order_id": "ZWU2Mjc0NmYtMDRiMy00ZFOZLTgzNWYtZDU5MGJmZjJmNjQ0",
    "discount_code": "100KR-SALE"
}
```

This object is sent to the webshop's discount URL. To make discounting
very flexible, we have chosen to have the shop-owner manage their own
discounts through their own endpoint.

To reiterate, you will **not** be crafting this first object as a
merchant. This object will be sent from the Stidner Checkout page when a
customer enters a discount code. As a merchant, you simply read this
request (which will be sent to the previously configured "discount" URL,
which was set in the [Order API](index.html)), and then respond in the format
defined in the [response section](#merchants-response).

Additionally, the merchant endpoint Stidner Checkout will be sending to:

- must be using HTTPS, and

- must accept requests only with the shared BasicAuth token
(as a reminder, you used it to POST to the [Order API](index.html)).


| Key name              | Type      | R/O/C    | Description                      |
|-----------------------|-----------|----------|----------------------------------|
| order_id              | String    | Required | The unique order ID. This should always be the existing ID generated by the /order API.                             |
| discount_code         | String    | Required | The discount code that a customer is trying to apply.
| merchant_reference1, merchant_reference2 | String     | Optional | Optional internal reference IDs.


## Merchant's response

> Example response (**SUCCESS**):

```http
HTTP/1.1 200 OK
Content-Type: application/json
```
```json
{
    "order_id": "ZWU2Mjc0NmYtMDRiMy00ZFOZLTgzNWYtZDU5MGJmZjJmNjQ0",
    "discount_code": "100KR-SALE"
    "name": "100kr sale!",
    "description": "Save 100kr on all orders more than 500 kr.",
    "artno": "discount_100530",
    "amount": "10000"
}
```

As said above, this is the merchant's part to handle; all the
converting, processing, etc is in your hands. Stidner Checkout will
simply take the amount returned here, and subtract it from the order's
total cost.

If the discount code was successful, your system should send back
everything it received in the above POST, plus adding on the
following:

1.  An article number for the discount,
2.  the name and description of the discount code, and
3.  how much currency to subtract from the order.

> Example response (**DENIAL**):

```http
HTTP/1.1 412 Precondition Failed
Content-Type: application/json
```
```json
{
    "order_id": "ZWU2Mjc0NmYtMDRiMy00ZFOZLTgzNWYtZDU5MGJmZjJmNjQ0",
    "discount_code": "100KR-SALE"
    "description": "Code only applies to orders of more than 500 kr.",
}
```

If the discount code is denied for some reason, the server should send
back only:

1. The order\_id,
2. the given discount\_code, and
3. a description of why it failed.

Additionally, the HTTP response code should be *anything except*
HTTP 200; we suggest HTTP 412.


| Key name              | Type      | R/O/C    | Description                      |
|-----------------------|-----------|----------|----------------------------------|
| order\_id             | String    | Read-Only| The unique order ID. This should always be the existing ID previously generated by the /order API.     |
| discount\_code        | String    | Read-Only| The discount code that a customer is trying to apply.
| merchant\_reference1, merchant\_reference2 | String    | Optional | Optional internal reference IDs.
| name, description     | String    | Required | A name and description of what the discount is for. This will be shown on various customer and merchant pages, so proper (non-"internal") descriptions and names are important, as to reduce any possible confusion! The description should be set to a customer-friendly error message if the discount code is denied; see above denial for an example.                         |
| artno                 | String    | Required | Article number for internal system.
| amount                | Integer   | Required | This should be how much to subtract from the order. This should be in basic units (meaning 100 SEK becomes '10000', 5 EUR is '500', etc).

